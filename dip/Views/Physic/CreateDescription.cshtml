

@model dip.Models.ViewModel.PhysicV.CreateDescriptionV

@{
    ViewBag.Title = "CreateDescription";
}


<h2>CreateDescription</h2>
<button class="btn btn-default" id="butInfoBlockId" onclick="showInfo()">Показать информацию</button>
<div style="display:none;" id="divInfoBlockId">
    <h2>Сохранятся только изменения тех элементов которые отображаются на экране на момент нажатия кнопки "сохранить"</h2>
    <h2>при удалении родителя, будут удалены(не будут добавлены новые) все дети</h2>
    <h2>actionId добавится только если он выбран</h2>
    <h2>удаление просходит блоками, так если одновременно запросить удаление spec и pros, удалиться может только 1 группа(например только pros) из них</h2>

</div>













<input type="hidden" id="parametric_action_or_not" value="@Model.ActionParametricIds" />
<div><label>Название воздействия</label></div>
<div class="form-horizontal">
    @*#line1*@
    
    <div id="actionId_all">

        @foreach (var i in Model.Form.ActionId)
            {
            <div class="padding_10_top">
                <input name="actionId" type="radio" value="@i.Id" id="@(i.Id+"_radio")" class="radioClass">
                <button class="btn btn-default" onclick="changeActionId('@i.Id')">Изменить</button>
                <button id="restoreInput_but_@i.Id" class="btn btn-default" onclick="restoreValue(1,'@i.Id')" style="display:none;">Восстановить значение</button>
                <button class="btn btn-default" id="@(i.Id+"_delbut")" onclick="deleteItemActionId('@i.Id')">Удалить</button>
                <input class="form-control" type="text" value="@i.Name" name="@i.Id" id="@(i.Id+"_inp")" readonly />
            </div>
        }


            </div>

    @*<div style="display:none;" id="create_descr_action_new_div">*@

        @*@Html.Editor("actionId_")*@
    <div class="padding_10_top">
        <input name="actionId" type="radio" value="VOZ0" id="VOZ0_radio" class="radioClass">
        <input type="checkbox" id="changeTypeParamActionId" @*onchange="changeTypeParamAction()"*@ name="changeTypeParamActionName" style="display:none;" title="Параметрическ" class="checkBoxClass"/>@*TODO Параметрическ(?)*@
        <input class="form-control" type="text" value="" name="VOZ0" id="VOZ0_inp" />
        
    </div>
        @*@Html.Editor("actionName")*@
        
    @*</div>*@

    <hr id="ScrollChangeActionId"/>









    @*#line2*@


    @*<div style="display:none;">
        <p>*по идеи не нужно,* нужно вынести как то отдельно, тк не имеет отношения к форме в целом</p>
        <select name=@("actionType") class="form-control" id=@("actionType")>
            * @foreach (var i in Model.Form.ActionType)
            {

                <option selected value="@i.Id">@i.Name</option>
            }*
        </select>
    </div>
    <hr />*@








    @*#line3*@
    @*<button id="changeTypeFizVelId_but_id" onclick="changeTypeFizVelId()">Добавить новые</button>*@
    <div id="fizVelGroup_np_label" style="display:none;">
        <label class="">Название физической величины</label>
    </div>


    <div id="fizVelGroup_p_label" style="display:none;">
        <label class="">Раздел физики</label>
    </div>
    <div  id="fizVelGroup_all" style="display:none;">
        <div id="fizVelGroup">
            <div class="" id="fizVel">@*form-group col-md-10*@
                @*@Html.Action("DescrFormFizVelsEdit", "Helpers", new { fizVelId = Model.Form.FizVelId })*@
            </div>



            </div>
        <button class="btn btn-default" id="addNewFizVelId_but_id" onclick="addNewFizVelId()">Добавить</button>
    </div>
    
 
    
    <hr id="ScrollChangeParamFizvelId"/>








    @*#line4*@
    
    <div id="parametricBlock_all">
       
        
            <div id="parametricFizVel_all"  style="display:none;">
                <div id="parametricFizVel_label">
                    <label class="">Название физической величины</label>

                </div>
                <div @*class="form-group"*@ id="parametricFizVel">
                    @*@Html.Action("DescrFormParamFizVelsEdit", "Helpers", new { parametricFizVelId = Model.Form.ParametricFizVelId })*@
                </div>
                    <button class="btn btn-default" id="addNewParametricFizVelId_but_id" onclick="addNewParametricFizVelId()">Добавить</button>
                <hr />
                </div>
        
       
    </div>

    







    @*#line checkboxes*@
    <div id="div_all_checkboxes" style="display:none;">
    @*#line5*@
    <div>
        <div id="prosGroup_all">
           
                <label class="">Пространственные характеристики</label>
            
            <div id="prosGroup">

            </div>
            <hr />
        </div>

        </div>

    








    @*#line6*@


        <div>
            <div id="specGroup_all">
                <label class="">Специальные характеристики</label>
                <div id="specGroup">
                   
                </div>
                <hr />
                </div>
            </div>

   













    @*#line7*@

    <div>
        @*@Html.Action("DescrFormVrem", "Helpers", new { type = "", vrems = Model.Vrems })*@
        <div id="vremGroup_all">
            <label class="">Временные характеристики</label>
            <div id="vremGroup">

               
            </div>
           
            </div>
        </div>
</div>

    <div class="errorDiv" style="display:none;" id="errorShowDiv"></div>
    <button class="btn btn-default" onclick="saveForm()">Сохранить</button>

    </div>





















<script>
    //mainObjEdit.massOldValue
    var mainObjEdit = {
        //newAction: false,
        //newFizVel: false,
        //newParamFizVel: false,
        curentActionId: '',
        curentFizVelId: '',
        parametricAction: false,
        //parametricActionNew: false,

        maxNewFizVelId: 1,
        maxNewParamFizVelId: 1,
        maxNewSpecId: 1,
        maxNewProId: 1,
        maxNewVremId: 1,

        massEditActionId:[],
        massEditFizVels:[],
        massEditParamFizVels:[],
        massEditPros:[],
        massEditVrems:[],
        massEditSpecs:[],

        massDeletedPros:[],
        massDeletedVrems:[],
        massDeletedSpecs: [],
        massDeletedFizVels: [],
        massDeletedActionId: [],


        massOldValue:[]

    };



   




    $(document).on('change', ':radio', function () {//$('input[type=radio][name=bedStatus]')
       
        switch (this.name) {
            case 'actionId':
                

                mainObjEdit.curentActionId = this.value;
                var value = this.value;

                if (this.value !== 'VOZ0') {
                    document.getElementById('changeTypeParamActionId').style.display = 'none';

                    var formData = {
                        fizVelId: value,

                    };


                    goAjaxRequest({
                        url: "/Actions/ChangeActionEdit",
                        data: formData,
                        func_success: function (req, status, jqXHR) {
                            var data = req.split('<hr />');//.responseText
                            //var type = data[0].trim();

                            //$('#fizVel').replaceWith(data[1]);
                            document.getElementById('fizVel').innerHTML = data[1];


                            document.getElementById('prosGroup').innerHTML = data[2];


                            document.getElementById('specGroup').innerHTML = data[3];


                            document.getElementById('vremGroup').innerHTML = data[4];

                            //document.getElementById('parametricFizVel').innerHTML = data[5];

                            document.getElementById('fizVelGroup_all').style.display = 'block';
                            //document.getElementById('parametricFizVel_all').style.display = 'block';

                            document.getElementById('div_all_checkboxes').style.display = 'block';
                            //$('#parametricFizVel').replaceWith(data[5]);
                            //определить тип и спрятать лишнее  //из результата не вытаскивать

                            $("html, body").animate({ scrollTop: $("#ScrollChangeActionId").offset().top }, "slow");
                            //fizVelGroup_np_label
                            if (checkParametricAction(value)) {
                                SetParametricalType(true);
                            }
                            else {
                                SetParametricalType(false);

                            }

                        }, type: 'POST'
                    });
                }
                else {//voz0
                    document.getElementById('fizVelGroup_all').style.display = 'block';
                    //document.getElementById('parametricFizVel_all').style.display = 'block';
                    document.getElementById('div_all_checkboxes').style.display = 'block';

                    document.getElementById('changeTypeParamActionId').style.display = 'block';
                    document.getElementById('fizVel').innerHTML = '';
                    document.getElementById('parametricFizVel').innerHTML = '';
                    document.getElementById('prosGroup').innerHTML = '<div class="form-group descrCheckBoxChildEdit">' +
                        '<div class="" id=\'VOZ0_PROS\'> </div> <div class=""> <button class="btn btn-default" onclick="addNewPro(\'VOZ0\')">Добавить</button> </div></div>';

                    document.getElementById('specGroup').innerHTML = '<div class="form-group descrCheckBoxChildEdit">' +
                        '<div class="" id=\'VOZ0_SPEC\'> </div> <div class=""> <button class="btn btn-default" onclick="addNewSpec(\'VOZ0\')">Добавить</button> </div></div>';
                    document.getElementById('vremGroup').innerHTML = '<div class="form-group descrCheckBoxChildEdit">' +
                        '<div class="" id=\'VOZ0_VREM\'> </div> <div class=""> <button class="btn btn-default" onclick="addNewVrem(\'VOZ0\')">Добавить</button> </div></div>';
                    //определить тип и спрятать лишнее 
                    if (checkParametricAction(value)) {
                        SetParametricalType(true);
                    }
                    else {
                        SetParametricalType(false);

                    }

                }
                document.getElementById('parametricFizVel_all').style.display = 'none';

                break;


            case 'fizVelId':
                mainObjEdit.curentFizVelId = this.value;
                if (this.value.indexOf("FizVelNameNEW")===-1)
                    goAjaxRequest({
                        url: '/Actions/GetParametricFizVelsEdit/' + this.value,
                        func_success: function (data, status, jqXHR) {
                            // Заменяем часть представления, отвечающего за выбор физической величины
                            //$('#parametricFizVel').replaceWith(data);
                            document.getElementById('parametricFizVel').innerHTML = data;
                            $("html, body").animate({ scrollTop: $("#ScrollChangeParamFizvelId").offset().top }, "slow");
                            
                        }
                    });
                if (mainObjEdit.parametricAction) {
                    document.getElementById('parametricFizVel').innerHTML = '';
                    document.getElementById('parametricFizVel_all').style.display = 'block';
                }
 
                break;
            
        }


    });


    $(document).on('change', ':checkbox', function () {

        switch (this.name) {
            case 'listSelectedPros':
                if (this.checked) {
                    loadCheckBoxChild(this, 'GetProsChildEdit');

                }
                else {
                    document.getElementById(this.value + '_childs').innerHTML = '';
                }

                break;

            case 'listSelectedSpecs':
                if (this.checked) {
                    loadCheckBoxChild(this, 'GetSpecChildEdit');
                }
                else {
                    document.getElementById(this.value + '_childs').innerHTML = '';
                }
                break;

            case 'listSelectedVrems':
                if (this.checked) {
                    loadCheckBoxChild(this, 'GetVremChildEdit');
                }
                else {
                    document.getElementById(this.value + '_childs').innerHTML = '';
                }
                break;

            case 'changeTypeParamActionName':
                if (this.checked) {
                    SetParametricalType(true);
                    
                }
                else {
                    SetParametricalType(false);
                    
                }
                break;

            case 'listSelectedProsNew':
                if (this.checked) {
                    document.getElementById(this.value + '_childs').innerHTML = ' <div class="form-group descrCheckBoxChildEdit"> \
           <div class="" id="'+ this.value + '_PROS"> </div>\
           <div class="">\
               <button class="btn btn-default" onclick="addNewPro(\'' + this.value + '\')">Добавить</button>\
           </div>\
       </div>';
                }
                else
                    document.getElementById(this.value + '_childs').innerHTML = '';
                //_PROS

                break;


            case 'listSelectedVremsNew':
                if (this.checked) {
                    document.getElementById(this.value + '_childs').innerHTML = ' <div class="form-group descrCheckBoxChildEdit"> \
           <div class="" id="' + this.value + '_VREM"> </div>\
           <div class="">\
               <button class="btn btn-default" onclick="addNewVrem(\'' + this.value + '\')">Добавить</button>\
           </div>\
       </div>';
                }
                else
                    document.getElementById(this.value + '_childs').innerHTML = '';
                //_VREM

                break;


            case 'listSelectedSpecsNew':
                if (this.checked) {
                    document.getElementById(this.value + '_childs').innerHTML = ' <div class="form-group descrCheckBoxChildEdit"> \
           <div class="" id="' + this.value + '_SPEC"> </div>\
           <div class="">\
               <button class="btn btn-default" onclick="addNewSpec(\'' + this.value + '\')">Добавить</button>\
           </div>\
       </div>';
                }
                else
                    document.getElementById(this.value + '_childs').innerHTML = '';
                //_SPEC
                break;
        }


    });




    function SetParametricalType(set) {
        if (set) {
            document.getElementById('prosGroup_all').style.display = 'none';
            document.getElementById('specGroup_all').style.display = 'none';
            document.getElementById('vremGroup_all').style.display = 'none';
            document.getElementById('parametricBlock_all').style.display = 'block';
            $('#fizVel input:radio').each(function () {//[type=checkbox] 
                $(this).css('display','block');
            });
            mainObjEdit.parametricAction = true;
            document.getElementById('fizVelGroup_np_label').style.display = 'none';
            document.getElementById('fizVelGroup_p_label').style.display = 'block';
        }
        else {
            document.getElementById('prosGroup_all').style.display = 'block';
            document.getElementById('specGroup_all').style.display = 'block';
            document.getElementById('vremGroup_all').style.display = 'block';
            document.getElementById('parametricBlock_all').style.display = 'none';
            $('#fizVel input:radio').each(function () {//[type=checkbox] 
                $(this).css('display', 'none');
            });
            mainObjEdit.parametricAction = false;
            document.getElementById('fizVelGroup_np_label').style.display = 'block';
            document.getElementById('fizVelGroup_p_label').style.display = 'none';
        }
        
        
    }




    function checkParametricAction(id) {
        if (id == 'VOZ0') {
            if (document.getElementById('changeTypeParamActionId').checked)
                return true;
        }
        else {


            var checkParametrics = document.getElementById('parametric_action_or_not').value.split(' ');
            for (var i = 0; i < checkParametrics.length; ++i) {//todo вынести в фукнцию

                if (checkParametrics[i] == id) {
                    return true;
                }
            }
        }
        return false;
    }



    function loadCheckBoxChild(ch, meth) {

        var div = document.getElementById((ch.value + "_childs"));

       
            goAjaxRequest({
                url: '/Actions/' + meth + '?id=' + ch.value,
                func_success: function (data, status, jqXHR) {

                    if (data.trim()) {
                        div.innerHTML = data;
                        //loadCheckBoxChild(ch, meth);
                    }
                    else {
                        div.remove();
                    }

                }
            });
       

    }






    //прячем
    function ReplaceDisplayNoneNew(newdiv, oldDiv, changeBut) {
        newdiv.style.display = 'none';
        oldDiv.style.display = 'block';
        if (changeBut)
            changeBut.innerHTML = 'Добавить новый';
    }

    function ReplaceDisplayNoneOld(newdiv, oldDiv, changeBut) {
        newdiv.style.display = 'block';
        oldDiv.style.display = 'none';
        if (changeBut)
            changeBut.innerHTML = 'Использовать существущие';
    }


    function addNewPro(id) {
        
        //if (!id)
        //    id = mainObjEdit.curentActionId;
        var div = document.getElementById(id + '_PROS');
        var strCur = id.split('_')[0] + '_PROS_NEW' + (mainObjEdit.maxNewProId++);



        $(div).append('<div class="one_check_line_edit" id="div_' + div.id + '_all"><input value="' + strCur +
            '" id="' + strCur + '_chch" class="checkBoxClass" name="listSelectedProsNew" type="checkbox"/>' +
            '<button class="btn btn-default" id="' + strCur + '_delbut"  onclick=\'deleteItemPro("' + strCur + '")\'>Удалить</button>' +
            '<input class="form-control" id="'
            + strCur + '_inp" type="text" name="' + id + '" /><div id="' + strCur + '_childs"></div></div>');

    }
    function addNewSpec(id) {
        //if (!id)
        //    id = mainObjEdit.curentActionId;
        var div = document.getElementById(id + '_SPEC');
        var strCur = id.split('_')[0] + '_SPEC_NEW' + (mainObjEdit.maxNewSpecId++);
        $(div).append('<div class="one_check_line_edit"  id="div_' + div.id + '_all"><input value="' + strCur +
            '" id="' + strCur + '_chch" class="checkBoxClass" name="listSelectedSpecsNew" type="checkbox"/>' +
            '<button class="btn btn-default" id="' + strCur + '_delbut"  onclick=\'deleteItemSpec("' + strCur + '")\'>Удалить</button>' +
            '<input class="form-control" id="'
            + strCur + '_inp"  type="text" name="' + id + '" /><div id="' + strCur + '_childs"></div></div>');
    }
    function addNewVrem(id) {
        //if (!id)
        //    id = mainObjEdit.curentActionId;
        var div = document.getElementById(id + '_VREM');
        var strCur = id.split('_')[0] + '_VREM_NEW' + (mainObjEdit.maxNewVremId++);
        $(div).append('<div class="one_check_line_edit"  id="div_' + div.id + '_all"><input value="' + strCur +
            '" id="' + strCur + '_chch" class="checkBoxClass" name="listSelectedVremsNew" type="checkbox"/>' +
            '<button class="btn btn-default" id="' + strCur + '_delbut" onclick=\'deleteItemVrem("' + strCur + '")\'>Удалить</button>' +
            '<input class="form-control" id="'
            + strCur + '_inp"  type="text" name="' + id + '" /><div id="' + strCur + '_childs"></div></div>');
    }

    function addNewFizVelId() {
        var div = document.getElementById('fizVel');
        var newMaxId= mainObjEdit.maxNewFizVelId++;
        var newMaxIdStr="FizVelNameNEW"+newMaxId;

        //div.innerHTML += '<input class="form-control" id="' +newMaxIdStr+
        //    '_inp" name="FizVelName" type="text" value="">';
        var res = "";
       

        res += '<div class="padding_10_top">';
        
        res += '<input name="fizVelId" type="radio" value="' + newMaxIdStr +
 '" id="' + newMaxIdStr +
 '_radio" class="radioClass" style="';
   
        if (mainObjEdit.parametricAction) {
            res += 'display: block;">';
        }
        else {
            res += 'display: none;">';
        }
        res += '<button id="' + newMaxIdStr + '_delbut" class="btn btn-default" onclick="deleteItemFizVels(\'' + newMaxIdStr +
            '\')">Удалить</button>'+
                    '<input class="form-control" type="text" value="" name="' + mainObjEdit.curentActionId +
            '" id="' + newMaxIdStr + '_inp" >' +
               ' </div>';


        $(div).append(res);

    }

    function addNewParametricFizVelId() {
        var div = document.getElementById('parametricFizVel');
        //div.innerHTML += '<input class="form-control" id="ParamFizVelNameNEW' + mainObjEdit.maxNewParamFizVelId++ +
        //    '_inp" name="ParamFizVelName" type="text" value="">';


        $(div).append(' <div class="padding_10_top">' +
                        '<button id="ParamFizVelNameNEW' + mainObjEdit.maxNewParamFizVelId + '_delbut" class="btn btn-default" onclick="deleteItemFizVels(\'ParamFizVelNameNEW' + mainObjEdit.maxNewParamFizVelId + '\')">Удалить</button>' +
                        '<input class="form-control" type="text" value="" name="' + mainObjEdit.curentFizVelId + '" id="ParamFizVelNameNEW' + mainObjEdit.maxNewParamFizVelId++ +
            '_inp" > </div>');


    }





    function changeActionId(id){

        var inp=$('#'+id+'_inp');
        var inpVal=inp.val();
        if ($(inp).prop('readonly')) {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditActionId.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditActionId.push(id);
                // document.getElementById('restoreInput_but_' + id).style.display = 'block';
            }


        }
        else {
            $(inp).prop('readonly', true);

            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(1, id);
                        return;
                    }
                    break;
                }
                    


        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }

    function changeFizVels(id){

        var inp=$('#'+id+'_inp');
        var inpVal = inp.val();
        if($(inp).prop('readonly'))  {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditFizVels.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditFizVels.push(id);
               
            }
                

        }
        else{
            $(inp).prop('readonly', true);
            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(2, id);
                        return;
                    }
                    break;
                }
                    
        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }
    
    
    function changeParamFizVels(id){

        var inp=$('#'+id+'_inp');
        var inpVal = inp.val();
        if($(inp).prop('readonly'))  {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditParamFizVels.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditParamFizVels.push(id);
                
            }
                

        }
        else{
            $(inp).prop('readonly', true);
            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(3, id);
                        return;
                    }
                    break;
                }
                    
        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }
    
    function changePros(id){

        var inp=$('#'+id+'_inp');
        var inpVal = inp.val();
        if($(inp).prop('readonly'))  {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditPros.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditPros.push(id);
           
            }
                

        }
        else{
            $(inp).prop('readonly', true);
            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(4, id);
                        return;
                    }
                    break;
                }
                    
        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }

    function changeSpecs(id){

        var inp = $('#' + id + '_inp');
        var inpVal = inp.val();
        if($(inp).prop('readonly'))  {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditSpecs.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditSpecs.push(id);
               
            }
                

        }
        else{
            $(inp).prop('readonly', true);
            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(5, id);
                        return;
                    }
                    break;
                }
                    
        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }



    function changeVrems(id){

        var inp = $('#' + id + '_inp');
        var inpVal = inp.val();
        if($(inp).prop('readonly'))  {
            $(inp).removeProp('readonly');
            if (!mainObjEdit.massEditVrems.includes(id)) {
                mainObjEdit.massOldValue.push({
                    id: id,
                    val: inpVal
                });
                mainObjEdit.massEditVrems.push(id);
              
            }
               

        }
        else{
            $(inp).prop('readonly', true);
            for (var i = 0; i < mainObjEdit.massOldValue.length; ++i)
                if (mainObjEdit.massOldValue[i].id == id) {
                    if (mainObjEdit.massOldValue[i].val == inpVal) {
                        restoreValue(6, id);
                        return;
                    }
                    break;
                }
                   
        }
        document.getElementById('restoreInput_but_' + id).style.display = 'inline';
    }

    
    
    //-----------------------------------??????????????????




    //type: 1-pros 2-spec,3-vrem
    function deleteItemPro(id) {
        deleteItem(id,1);
    }
    function deleteItemSpec(id) {
        deleteItem(id, 2);
    }
    function deleteItemVrem(id) {
        deleteItem(id, 3);
    }
    function deleteItemFizVels(id) {
        deleteItem(id, 4);
    }
    function deleteItemActionId(id){
        deleteItem(id, 5);
    }

    //type: 1-pros 2-spec,3-vrem,4-fizvels
    function deleteItem(id,type) {
        // <div id="div_(pro.Id)_all">
        var delbut = document.getElementById(id + '_delbut');
        var checkboxChilds = $('#' + id + '_chch');
        var inp = $('#' + id + '_inp');
        if (delbut.innerHTML.trim() == 'Удалить') {
            //"удаляем"
            if (id.indexOf('NEW') < 0) {
                switch (type) {
                    case 1:
                        mainObjEdit.massDeletedPros.push(id);
                        break;
                    case 2:
                        mainObjEdit.massDeletedSpecs.push(id);
                        break;
                    case 3:
                        mainObjEdit.massDeletedVrems.push(id);
                        break;
                    case 4:
                        mainObjEdit.massDeletedFizVels.push(id);
                        break;
                    case 5:
                        mainObjEdit.massDeletedActionId.push(id);
                        break;
                }
            }
           
            delbut.innerHTML = 'Восстановить';
            var divChilds = document.getElementById(id + '_childs');
            if ($("div").is('#' + id + '_childs'))//TODO $("div").is('#'+id + '_childs')
            divChilds.innerHTML = '';
            if ($("input").is('#' + id + '_chch')) {//TODO $("div").is('#' + id + '_chch')
                $(checkboxChilds).removeAttr("checked")//$(ch).prop("checked")
                $(checkboxChilds).css('display', 'none');
            }
            
            $(inp).css('background-color', 'grey');
            $(inp).prop('readonly', true);
            
        }
        else {
            //восстанавливаем
            if (id.indexOf('NEW') < 0) {
                switch (type) {
                    case 1:
                        for (var i = 0; i < mainObjEdit.massDeletedPros.length; ++i) {
                            if (mainObjEdit.massDeletedPros[i] == id) {
                                mainObjEdit.massDeletedPros.splice(i, 1);
                                break;
                            }
                        }

                        break;
                    case 2:
                        //mainObjEdit.massDeletedSpecs.push(id);
                        for (var i = 0; i < mainObjEdit.massDeletedSpecs.length; ++i) {
                            if (mainObjEdit.massDeletedSpecs[i] == id) {
                                mainObjEdit.massDeletedSpecs.splice(i, 1);
                                break;
                            }
                        }
                        break;
                    case 3:
                        //mainObjEdit.massDeletedVrems.push(id);
                        for (var i = 0; i < mainObjEdit.massDeletedVrems.length; ++i) {
                            if (mainObjEdit.massDeletedVrems[i] == id) {
                                mainObjEdit.massDeletedVrems.splice(i, 1);
                                break;
                            }
                        }
                        break;
                    case 4:
                        //mainObjEdit.massDeletedVrems.push(id);
                        for (var i = 0; i < mainObjEdit.massDeletedFizVels.length; ++i) {
                            if (mainObjEdit.massDeletedFizVels[i] == id) {
                                mainObjEdit.massDeletedFizVels.splice(i, 1);
                                break;
                            }
                        }
                        break;
                    case 5:
                        //mainObjEdit.massDeletedVrems.push(id);
                        for (var i = 0; i < mainObjEdit.massDeletedActionId.length; ++i) {
                            if (mainObjEdit.massDeletedActionId[i] == id) {
                                mainObjEdit.massDeletedActionId.splice(i, 1);
                                break;
                            }
                        }
                        break;
                }
            }
            else {
                $(inp).removeProp('readonly');
            }
            delbut.innerHTML = 'Удалить';
            $(checkboxChilds).css('display', 'inline');
            //
            $(inp).css('background-color', '');


        }
    }

    


    function restoreValue(type, id) {
        
        for(var i=0;i<mainObjEdit.massOldValue.length;++i){
            if (mainObjEdit.massOldValue[i].id == id) {
                document.getElementById(id + '_inp').value = mainObjEdit.massOldValue[i].val;
                mainObjEdit.massOldValue.splice(i, 1);
                switch(type){
                    case 1:
                        for(var i2=0;i2<mainObjEdit.massEditActionId.length;++i2){
                            if(mainObjEdit.massEditActionId[i2]==id){
                                mainObjEdit.massEditActionId.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    case 2:
                        for(var i2=0;i2<mainObjEdit.massEditFizVels.length;++i2){
                            if(mainObjEdit.massEditFizVels[i2]==id){
                                mainObjEdit.massEditFizVels.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    case 3:
                        for(var i2=0;i2<mainObjEdit.massEditParamFizVels.length;++i2){
                            if(mainObjEdit.massEditParamFizVels[i2]==id){
                                mainObjEdit.massEditParamFizVels.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    case 4:
                        for(var i2=0;i2<mainObjEdit.massEditPros.length;++i2){
                            if(mainObjEdit.massEditPros[i2]==id){
                                mainObjEdit.massEditPros.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    
                    case 5:
                        for(var i2=0;i2<mainObjEdit.massEditSpecs.length;++i2){
                            if(mainObjEdit.massEditSpecs[i2]==id){
                                mainObjEdit.massEditSpecs.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    case 6:
                        for (var i2 = 0; i2 < mainObjEdit.massEditVrems.length; ++i2) {
                            if (mainObjEdit.massEditVrems[i2] == id) {
                                mainObjEdit.massEditVrems.splice(i2, 1);
                                break;
                            }
                        }
                        break;
                    
                }
               
                break;
            }
               
            
        }
        var inp = $('#' + id + '_inp');
        $(inp).prop('readonly', true);
        document.getElementById('restoreInput_but_' + id).style.display = 'none';
        // document.getElementById('restoreInput_but_' + id).style.display = 'none';
    }



    function saveForm() {
        //TODO валидация


        var formData = {
            //json: JSON.stringify(resMass)
            currentActionId: mainObjEdit.curentActionId

        };
        if (!formData.currentActionId) {
            alert('Необходимо выбрать "Название воздействия" независимо от желаемого действия')
            return;
        }

        //type: 1-actionid ,2-fizvell,3-paramfizvell,4-pros,5-spec,6-vrem
        //TypeAction: 1-добавление ,2-редактирование, 3- удаление
        function construct_(iter,prop,id, parentId, text, parametric) {
            //return struct = {
            //    Id: id,
            //    ParentId: parentId,
            //    //Type: type,
            //    Text: text,
            //    Parametric: parametric,
            //    //TypeAction: typeAction
            //};
            formData['obj.' + prop + '[' + iter + '].Id'] = id;
            formData['obj.' + prop + '[' + iter + '].ParentId'] = parentId;
            formData['obj.' + prop + '[' + iter + '].Text'] = text;
            formData['obj.' + prop + '[' + iter + '].Parametric'] = parametric;
        }
        
        


        //var resMass = [];

        //var curentActionId;
        var curentFizVel=null;


        //$('#actionId_all input:radio:checked').each(function () {//[type=checkbox] 
        //    curentActionId= this.val();
        //});
        $('#fizVel input:radio:checked').each(function () {//[type=checkbox] 
            //curentFizVel = this.val();
            curentFizVel = this.value;
        });
        //struct.Parametric = mainObjEdit.parametricAction;

        var iteration = 0;
        //отредактированные actionId
        for (var i = 0; i < mainObjEdit.massEditActionId.length; ++i) {
            //var checkObj=$('#'+mainObjEdit.massEditActionId[i]+'_inp');
            var strId = '#' + mainObjEdit.massEditActionId[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId)) {
                //formData['obj.massEditActionId[' + i + '].Id'] = mainObjEdit.massEditActionId[i];
                //formData['obj.massEditActionId[' + i + '].ParentId'] = null;
                //formData['obj.massEditActionId[' + i + '].Text'] = $(checkObj).val();
                //formData['obj.massEditActionId[' + i + '].Parametric'] = false;
                construct_(iteration++, 'MassEditActionId', mainObjEdit.massEditActionId[i], null, $(checkObj).val(), false);
            }
                
                //resMass.push(construct_(mainObjEdit.massEditActionId[i], null,  $(checkObj).val(), false));
        }
        iteration = 0;
        //отредактированные FizVels
        for (var i = 0; i < mainObjEdit.massEditFizVels.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massEditFizVels[i] + '_inp');
            var strId = '#' + mainObjEdit.massEditFizVels[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassEditFizVels', mainObjEdit.massEditFizVels[i], mainObjEdit.curentActionId, $(checkObj).val(), false);
        }
        iteration = 0;
        //отредактированные ParamFizVels
        for (var i = 0; i < mainObjEdit.massEditParamFizVels.length; ++i) {
           // var checkObj = $('#' + mainObjEdit.massEditParamFizVels[i] + '_inp');
            var strId = '#' + mainObjEdit.massEditParamFizVels[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassEditParamFizVels', mainObjEdit.massEditParamFizVels[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //отредактированные pro
        for (var i = 0; i < mainObjEdit.massEditPros.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massEditPros[i] + '_inp');
            var strId = '#' + mainObjEdit.massEditPros[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassEditPros', mainObjEdit.massEditPros[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //отредактированные spec
        for (var i = 0; i < mainObjEdit.massEditSpecs.length; ++i) {
           // var checkObj = $('#' + mainObjEdit.massEditSpecs[i] + '_inp');
            var strId = '#' + mainObjEdit.massEditSpecs[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassEditSpecs', mainObjEdit.massEditSpecs[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //отредактированные vrem
        for (var i = 0; i < mainObjEdit.massEditVrems.length; ++i) {
           // var checkObj = $('#' + mainObjEdit.massEditVrems[i] + '_inp');
            var strId = '#' + mainObjEdit.massEditVrems[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassEditVrems', mainObjEdit.massEditVrems[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //удаленные pro
        for (var i = 0; i < mainObjEdit.massDeletedPros.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massDeletedPros[i] + '_inp');
            var strId = '#' + mainObjEdit.massDeletedPros[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassDeletedPros', mainObjEdit.massDeletedPros[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //удаленные spec
        for (var i = 0; i < mainObjEdit.massDeletedSpecs.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massDeletedSpecs[i] + '_inp');
            var strId = '#' + mainObjEdit.massDeletedSpecs[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassDeletedSpecs', mainObjEdit.massDeletedSpecs[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //удаленные vrem
        for (var i = 0; i < mainObjEdit.massDeletedVrems.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massDeletedVrems[i] + '_inp');
            var strId = '#' + mainObjEdit.massDeletedVrems[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassDeletedVrems', mainObjEdit.massDeletedVrems[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //удаленные fizvels
        for (var i = 0; i < mainObjEdit.massDeletedFizVels.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massDeletedVrems[i] + '_inp');
            var strId = '#' + mainObjEdit.massDeletedFizVels[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassDeletedFizVels', mainObjEdit.massDeletedFizVels[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //удаленные actionid
        for (var i = 0; i < mainObjEdit.massDeletedActionId.length; ++i) {
            //var checkObj = $('#' + mainObjEdit.massDeletedVrems[i] + '_inp');
            var strId = '#' + mainObjEdit.massDeletedActionId[i] + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(iteration++, 'MassDeletedActionId', mainObjEdit.massDeletedActionId[i], checkObj.prop('name'), $(checkObj).val(), false);
        }
       
       
        //добавление actionId
        if (mainObjEdit.curentActionId == 'VOZ0') {

            //var checkObj = $('#VOZ0_inp');
            var strId = '#VOZ0_inp';
            var checkObj = $(strId);
            if ($("input").is(strId))
                construct_(0, 'MassAddActionId', 'VOZ0', null, $(checkObj).val(), document.getElementById('changeTypeParamActionId').checked);
        }
        iteration = 0;
        //добавление FizVel
        for (var i = 1; i < mainObjEdit.maxNewFizVelId; ++i) {
           // var checkObj = $('#FizVelNameNEW' + mainObjEdit.maxNewFizVelId[i] + '_inp');
            var strId = '#FizVelNameNEW' + i + '_inp';
            var checkObj = $(strId);
           // var asd = $(checkObj).css('background-color');
            if ($("input").is(strId) && $(checkObj).css('background-color') != 'rgb(128, 128, 128)')
                construct_(iteration++, 'MassAddFizVels', 'FizVelNameNEW' + i, checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        if (curentFizVel && $('#' + curentFizVel + '_inp').css('background-color') != 'rgb(128, 128, 128)')
        //добавление ParamFizVel
        for (var i = 1; i < mainObjEdit.maxNewParamFizVelId; ++i) {
            //var checkObj = $('#ParamFizVelNameNEW' + mainObjEdit.maxNewParamFizVelId[i] + '_inp');
            var strId = '#ParamFizVelNameNEW' + i + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId) && $(checkObj).css('background-color') != 'rgb(128, 128, 128)')
                construct_(iteration++, 'MassAddParamFizVels', 'ParamFizVelNameNEW' + i, curentFizVel, $(checkObj).val(), false);
        }

        iteration = 0;
        //добавление pro
        for (var i = 1; i < mainObjEdit.maxNewProId; ++i) {
            //var checkObj = $('#' + mainObjEdit.curentActionId + "_PROS_NEW" + mainObjEdit.maxNewProId[i] + '_inp');//VOZ8_PROS_NEW2_inp
            var strId = '#' + mainObjEdit.curentActionId + "_PROS_NEW" + i + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId) && $(checkObj).css('background-color') != 'rgb(128, 128, 128)')
                construct_(iteration++, 'MassAddPros', mainObjEdit.curentActionId + "_PROS_NEW" + i, checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //добавление spec
        for (var i = 1; i < mainObjEdit.maxNewSpecId; ++i) {
            var strId = '#' + mainObjEdit.curentActionId + "_SPEC_NEW" + i + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId) && $(checkObj).css('background-color') != 'rgb(128, 128, 128)')
                construct_(iteration++, 'MassAddSpecs', mainObjEdit.curentActionId + "_SPEC_NEW" + i, checkObj.prop('name'), $(checkObj).val(), false);
        }
        iteration = 0;
        //добавление vrem
        for (var i = 1; i < mainObjEdit.maxNewVremId; ++i) {
            
            var strId = '#' + mainObjEdit.curentActionId + "_VREM_NEW" + i + '_inp';
            var checkObj = $(strId);
            if ($("input").is(strId) && $(checkObj).css('background-color') != 'rgb(128, 128, 128)')
                construct_(iteration++, 'MassAddVrems', mainObjEdit.curentActionId + "_VREM_NEW" + i, checkObj.prop('name'), $(checkObj).val(), false);
        }

        


        
        




        goAjaxRequest({
            url: "/Physic/CreateDescription",
            data: formData,
            func_success: function (req, status, jqXHR) {
                //var data = req;//.responseText
                //var type = data[0].trim();
                var erdiv=document.getElementById('errorShowDiv');
                if (req == '+'){
                    alert('Изменено, перезагрузите страницу');
                    erdiv.style.display='none';

                }
                else{
                    erdiv.innerHTML = req;
                    erdiv.style.display='block';
                }
                    
                   // alert();
            }, type: 'POST'
        });


    }


    function showInfo() {
        var div=document.getElementById('divInfoBlockId');
        var but=document.getElementById('butInfoBlockId');
        if(div.style.display == 'block'){
            div.style.display='none';
            but.innerHTML = 'Показать информацию';
        }
        else{
            div.style.display = 'block';
            but.innerHTML = 'Скрыть информацию';
        }
        
        
    }






</script>














