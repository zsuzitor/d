
@{
    ViewBag.Title = "ListUserAct";
}

<h2>ListUserAct</h2>





<div class="ListUserAct_MainDiv">
    <div class="ListUserAct_OneColumn div_inline_block">
        <div>
            пользователи
            <input class="form-control" type="text" id="currentUserId_id" placeholder="Введите id пользователя"/>

            <button id="butLoadAllUsers" class="btn btn-default" onclick="LoadAllUsers()">Показать всех пользователей</button>
            <div id="ListAllUsers_id" style="display:none;">

            </div>
        </div>
    </div><div class="ListUserAct_OneColumn div_inline_block">
              <div>
                  то что уже закреплено
                  <div>
                      <button id="buttonChangeViewHList" class="btn btn-default" onclick="ShowAssignList()">Списки</button>
                      <button id="buttonChangeViewHPhys" class="btn btn-default" onclick="ShowAssignPhys()">ФЭ</button>
                      <div class="OneUserOwnContent">
                          <div id="AssignsList_id" style="display:none;">
                              
                          </div>
                          <div id="AssignsPhys_id" style="display:none;">
                             
                          </div>
                          
                          
                      </div>
                      </div>


              </div>
    <hr />
              <div>
                  то что не закреплено
                  <div>
                      <button id="buttonChangeViewNHList" class="btn btn-default" onclick="ShowNotAssignList()">Списки</button>
                      <button id="buttonChangeViewNHPhys" class="btn btn-default" onclick="ShowNotAssignPhys()">ФЭ</button>
                     
                      <div class="OneUserNotOwnContent">
                          <div id="ForAssignsList_id" style="display:none;">
                              <input onchange="clearListFeLink()" type="number" id="newAssignList" />
                              @*<button  class="btn btn-default" onclick="AssignListToUser()">Присвоить</button>*@
                              <button class="btn btn-default" onclick="ShowLinkListFe()">Показать Ссылку на список</button>
                              <div class="button_circle_img_30 button_circle_plus_ div_inline_block" onclick="AssignListToUser()" title="Присвоить"></div>

                              <div id="divLinkCurrListFe_id"></div>
                              @*<div><p>список</p><button class="btn btn-default" onclick="">просмотр</button><button class="btn btn-default" onclick="">закинуть пользователю</button></div>*@
                          </div>
                          <div id="ForAssignsPhys_id" style="display:none;">
                              <input onchange="clearFeLink()" type="number" id="newAssignPhys" />
                              @*<button  class="btn btn-default" onclick="AssignPhysicToUser()">Присвоить</button>*@

                              <button class="btn btn-default" onclick="ShowLinkFetext()">Показать Ссылку на страницу ФЭ</button>
                              <div class="button_circle_img_30 button_circle_plus_ div_inline_block" onclick="AssignPhysicToUser()" title="Присвоить"></div>

                              @*<a onclick="alert()">Страница ФЭ</a>*@
                              @*<div><p>ФЭ-ссылка</p><button class="btn btn-default" onclick="">закинуть пользователю</button></div>*@
                              <div id="divLinkCurrFetext_id"></div>
                          </div>
                          
                      </div>
                  </div>


              </div>
    </div>
    



</div>





<script>

    function ShowAssignList() {
        document.getElementById('AssignsList_id').style.display='block';

        document.getElementById('AssignsPhys_id').style.display = 'none';
        changeTypeButton('buttonChangeViewHList', 'buttonChangeViewHPhys');

        var formData = { iduser: document.getElementById('currentUserId_id').value };
        if (!formData.iduser.trim())
            alert('Введите id пользователя');
        goAjaxRequest({
            url: "/ListPhysics/AssignsUsersList",
            data: formData,
            func_success: function (req, status, jqXHR) {
                document.getElementById('AssignsList_id').innerHTML = req;

            }, type: 'GET'
        });



    }

    function ShowAssignPhys() {
        document.getElementById('AssignsList_id').style.display = 'none';

        document.getElementById('AssignsPhys_id').style.display = 'block';
        changeTypeButton('buttonChangeViewHPhys', 'buttonChangeViewHList');
        var formData = { iduser: document.getElementById('currentUserId_id').value };
        if (!formData.iduser.trim())
            alert('Введите id пользователя');
        goAjaxRequest({
            url: "/ListPhysics/AssignsUsersPhysics",
            data: formData,
            func_success: function (req, status, jqXHR) {
                document.getElementById('AssignsPhys_id').innerHTML = req;

            }, type: 'GET'
        });
    }
    

    function changeTypeButton(idna,ida) {
        var butlist = document.getElementById(idna);
        //butlist.style.display = 'block';
        butlist.classList.remove('btn-default');
        butlist.classList.add('btn-primary');

        var butphys = document.getElementById(ida);
        //butphys.style.display = 'none';
        butphys.classList.add('btn-default');
        butphys.classList.remove('btn-primary');
    }


    function ShowNotAssignList() {
        changeTypeButton('buttonChangeViewNHList', 'buttonChangeViewNHPhys');
        var butlist = document.getElementById('ForAssignsList_id');
        butlist.style.display = 'block';
        var butlist = document.getElementById('ForAssignsPhys_id');
        butlist.style.display = 'none';

    }

    function ShowNotAssignPhys() {
        changeTypeButton('buttonChangeViewNHPhys', 'buttonChangeViewNHList');
        var butlist = document.getElementById('ForAssignsPhys_id');
        butlist.style.display = 'block';
        var butlist = document.getElementById('ForAssignsList_id');
        butlist.style.display = 'none';

        
    }


    function AssignListToUser() {
        
        var formData = { iduser: document.getElementById('currentUserId_id').value, idlist:document.getElementById('newAssignList').value };
        //string iduser, int idlist)
        if (!formData.idlist) {
            alert('Введите id');
            return;
        }
        goAjaxRequest({
            url: "/ListPhysics/AssignListToUser",
            data: formData,
            func_success: function (req, status, jqXHR) {
                //alert('result AssignListToUser');
                var blockLists=document.getElementById('listListsFeExist');
                if (blockLists) {
                    blockLists.innerHTML += req;
                }

            }, type: 'POST'
        });
        
    }

    function AssignPhysicToUser() {
        var formData = { iduser: document.getElementById('currentUserId_id').value, idphys: document.getElementById('newAssignPhys').value };
        //string iduser, int idlist)
        if (!formData.idphys) {
            alert('Введите id');
            return;
        }
        goAjaxRequest({
            url: "/ListPhysics/AssignPhysicToUser",
            data: formData,
            func_success: function (req, status, jqXHR) {
                //alert('result AssignListToUser');
                var blockfes = document.getElementById('divAllFetextExist_id');
                if (blockfes) {
                    blockfes.innerHTML += req;
                }
                

            }, type: 'POST'
        });
    }
    

    function ShowLinkFetext() {
        let link = '/Physic/Details/';
        let idfe = document.getElementById("newAssignPhys").value;
        link += idfe;
        let tegA = '<a href="'+link+'">Страница ФЭ</a>' ;
        if (idfe) 
            document.getElementById('divLinkCurrFetext_id').innerHTML = tegA;
    }
    function clearFeLink() {
        document.getElementById('divLinkCurrFetext_id').innerHTML = '';
    }

    function ShowLinkListFe() {
        let link = '/ListPhysics/ListAct?currentListId=';
        let idfe = document.getElementById("newAssignList").value;
        link += idfe;
        let tegA = '<a href="' + link + '">Страница просмотра списка</a>';
        if (idfe)
            document.getElementById('divLinkCurrListFe_id').innerHTML = tegA;
    }

    function clearListFeLink() {
        document.getElementById('divLinkCurrListFe_id').innerHTML = '';
    }


    function ShowLinkFetextExist() {
        let link = '/Physic/Details/';
        let idfe = document.getElementById("AssignPhysForDel").value;
        link += idfe;
        let tegA = '<a href="' + link + '">Страница ФЭ</a>';
        if (idfe)
            document.getElementById('divLinkCurrFetextExist_id').innerHTML = tegA;
    }
    function clearFeExistLink() {
        document.getElementById('divLinkCurrFetextExist_id').innerHTML = '';
    }

    function ShowLinkListFeExist() {
        let link = '/ListPhysics/ListAct?currentListId=';
        let idfe = document.getElementById("AssignListForDel").value;
        link += idfe;
        let tegA = '<a href="' + link + '">Страница просмотра списка</a>';
        if (idfe)
            document.getElementById('divLinkCurrListFeExist_id').innerHTML = tegA;
    }

    function clearListFeLinkExist() {
        document.getElementById('divLinkCurrListFeExist_id').innerHTML = '';
    }


    function removeListFromUser(id) {
        if (!id) 
            id = document.getElementById('AssignListForDel').value;

        if (!id) {
            alert('Не выбран список');
            return;
        }
            
        var formData = { iduser: document.getElementById('currentUserId_id').value, idlist: id };
       
        goAjaxRequest({
            url: "/ListPhysics/RemoveListFromUser",
            data: formData,
            func_success: function (req, status, jqXHR) {
                //alert('result removeListFromUser');
                if (req.trim()) {
                    document.getElementById('divOneListFeExist_' + id).remove();

                }
                
            }, type: 'POST'
        });

    }

    function removePhysFromUser(id) {
        if (!id) 
            id = document.getElementById('AssignPhysForDel').value;
            
        if (!id) {
            alert('Не выбран ФЭ');
            return;
        }

        var formData = { iduser: document.getElementById('currentUserId_id').value, idphys: id };

        goAjaxRequest({
            url: "/ListPhysics/RemovePhysicFromUser",
            data: formData,
            func_success: function (req, status, jqXHR) {
                //alert('result removePhysFromUser');
                if (req.trim()) {
                    document.getElementById('divOnePhysExist_' + id).remove();

                }

            }, type: 'POST'
        });
    }


    function ListUsersShortDataButton(id) {
        document.getElementById('currentUserId_id').value = id;
    }

    function LoadAllUsers() {
        var formData = { };
        var div = document.getElementById('ListAllUsers_id');
        var but = document.getElementById('butLoadAllUsers');
        if (!div.innerHTML.trim()) {
            //загрузить
            goAjaxRequest({
                url: "/Admin/GetAllUsersShortDataWithBut",
                data: formData,
                func_success: function (req, status, jqXHR) {
                    div.innerHTML = req;

                }, type: 'GET'
            });
            div.style.display = 'block';
            but.innerHTML = 'Скрыть пользователей';
        }
        else {
            //загружать не надо, надо показать\скрыть
            if (div.style.display == 'block') {
                //скрыть
                div.style.display = 'none';
                but.innerHTML = 'Показать всех пользователей';
            }
            else {
                //показать
                div.style.display = 'block';
                but.innerHTML = 'Скрыть пользователей';
            }
        }
       
        
        
    }


</script>