


@model dip.Models.ViewModel.SearchV.TextSearchV


@{
    ViewBag.Title = "TextSearch";
}

<h2>TextSearch</h2>


<div>
    <div class="div_inline_block textSearchMainHalf">
        <div>
        <textarea id="TextForSearch_id" placeholder="Введите текст"></textarea>
        </div>
        <div id="InfoCurrentTypeSearch"></div>
    </div><div  class="div_inline_block textSearchMainHalf">
        <div>выбор типа поиска
            <div id="divTypesSearch_id">
                <p>
<input name="searchTypeRadio" type="radio" class="radioClass" id="lucene_radio" value="lucene" />
                    <label for="lucene_radio">lucene</label>
</p>
                <p>
<input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchF_radio" value="fullTextSearchF" />
                    <label for="fullTextSearchF_radio">fullTextSearchF</label></p>
                
                <p>
<input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchCf_radio" value="fullTextSearchCf" />
                    <label for="fullTextSearchCf_radio">fullTextSearchCf</label></p>
                
                <p>
<input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchCl_radio" value="fullTextSearchCl" />
                    <label for="fullTextSearchCl_radio">fullTextSearchCl</label></p>
                
                <p>
<input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchNear_radio" value="fullTextSearchNear" />
                    <label for="fullTextSearchNear_radio">fullTextSearchNear</label></p>
               
                @if (Model.Admin)
                {
                    <p>
                        <input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchSemantic_radio" value="fullTextSearchSemantic" />
                        <label for="fullTextSearchSemantic_radio">fullTextSearchSemantic</label>
                    </p>
                }
                

                <p>
                    <input name="searchTypeRadio" type="radio" class="radioClass" id="NGrammSearch_radio" value="NGrammSearch" />
                    <label for="NGrammSearch_radio">NGrammSearch</label>
                </p>

                <p>
                    <input name="searchTypeRadio" type="radio" class="radioClass" id="fullTextSearchMainSemanticWord_radio" value="fullTextSearchMainSemanticWord" />
                    <label for="fullTextSearchMainSemanticWord_radio">fullTextSearchMainSemanticWord</label>
                </p>
                
            </div>
    
    </div>
    <button onclick="loadNewFT()" class="btn btn-default">Поиск</button>
    </div>
</div>












<div id="div_search_ft_result_id">
    @*@Html.Action("ListFeText", "Physic", new { listId = Model.ListPhysId.ToArray() })*@


</div>
@*@if (Model.ShowBtLoad != false)
{*@
    <p class="text-center">
        <div class="div_search_ft_but" style="display:none;" id="div_search_ft_but_id">
            <button class="width_100per btn btn-default" onclick="loadMoreFT()">загрузить еще</button>
        </div>
    </p>
@*}*@


<script>
    var TextSearchObj = {};

    $(document).on('change', ':radio', function () {

        if (this.name == 'searchTypeRadio') {
            let infodiv = document.getElementById('InfoCurrentTypeSearch');
            let strInfo='';
            switch (this.value) {

                case 'lucene':
                    strInfo='Полнотекстовый поиск lucene';
                    break;


                case 'fullTextSearchF':
                    strInfo = 'Обычный полнотекстовый поиск fullTextSearch';
                    break;

                case 'fullTextSearchCf':
                    strInfo = 'Поиск форм слов, можно использовать (#слово) для повышения важности слова';
                    break;

                case 'fullTextSearchCl':
                    strInfo = 'Поиск по вхождениям, можно использовать (#слово) для повышения важности слова';
                    break;

                case 'fullTextSearchNear':
                    strInfo = 'Поиск фразы, включенные слова ищутся рядом с другими включенными словами, поиск для 2+ слов';
                    break;

                case 'fullTextSearchSemantic':
                    strInfo = 'Семантический поиск. В бд создана запись, в нее заносится строка поиска и'+
                        'определяются похожие средствами sql server. С данным типом поиска можно работать '+
                        'одновременно только 1 человеку(тк запись 1 и она блокируется до окончания выполнения запроса, '+
                        'запись можно насильно разблокировать нажав на кнопку). '+
                        '<button onclick="ReloadSemantic()">Насильно обнулить запись для поиска</button>';
                    break;
                case 'NGrammSearch':
                    strInfo = 'Поиск N граммами, ресурсоемкий, лучше использовать для короткой строки запроса';
                    break;
                case 'fullTextSearchMainSemanticWord':
                    strInfo = 'В каждой записи ФЭ семантически выбираются главные слова  результат сопостовляется с запросом'+
                        'Наименее точный поиск. Поиск происходит не по всем записям(зависит от текста)';
                    break;

                    
            }
            infodiv.innerHTML = strInfo
            
        }

    });



    function loadNewFT() {
        TextSearchObj.curTextS = document.getElementById('TextForSearch_id').value;

        $('#divTypesSearch_id input:radio:checked').each(function () {//[type=checkbox] 
            //curListId = this.id.split('ListPhysExistItem_')[1];
            TextSearchObj.curTypeS = this.value;
        });

        if (!TextSearchObj.curTypeS) {
            alert('Выберите тип поиска');
            return;
        }
        if (!TextSearchObj.curTextS) {
            alert('Введите текст');
            return;
        }

        document.getElementById('div_search_ft_result_id').innerHTML = '';
        loadMoreFT();
    }


    var block_load = false;
   // var NumLoad = 2;
    function loadMoreFT() {

        //если вернулся пустой список то возвращать статус серва с ошибкой, блокировать множественное нажатие кнопки

        if (!block_load) {
            block_load = true;

            var formData = {
                str: TextSearchObj.curTextS
               // str: document.getElementById('TextForSearch_id').value
            };
            //$('#divTypesSearch_id input:radio:checked').each(function () {//[type=checkbox] 
            //    //curListId = this.id.split('ListPhysExistItem_')[1];
            //    formData.type = this.value;
            //}); 

            //if (!formData.type) {
            //    alert('Выберите тип поиска');
            //    return;
            //}
            formData.type = TextSearchObj.curTypeS;
            
            var div_last_load_c = document.getElementById('div_search_ft_result_id').children;
            if (div_last_load_c.length > 0) {
                var div_last_load = div_last_load_c[div_last_load_c.length - 1];
                formData.countLoad = +div_last_load.id.split('_')[6] + 1;
                var div_last_fe_c = div_last_load.children;
                var div_last_fe = div_last_fe_c[div_last_fe_c.length - 1];
                formData.lastId = div_last_fe.id.split('_')[5];
            }
           
            goAjaxRequest({
                url: '/Search/TextSearchPartial',
                data: formData,
                func_complete: function (req, status, jqXHR) {
                    block_load = false;
                    //document.getElementById('div_search_ft_but_id').style.display = 'none';

                },
                func_error: function (req, status, jqXHR) {
                    document.getElementById('div_search_ft_but_id').style.display = 'none';
                },
                func_success: function (req, status, jqXHR) {
                    if (jqXHR.status == 204) {
                        //document.getElementById('div_search_ft_but_id').innerHTML = '';
                        document.getElementById('div_search_ft_but_id').style.display = 'none';
                        //block_load = false;
                    }
                    else if (jqXHR.status == 207) {
                        alert('Попробуйте позже, запись занята');
                    }
                    else {
                        document.getElementById('div_search_ft_but_id').style.display = 'inline';
                        var div = document.getElementById('div_search_ft_result_id');
                        div.innerHTML += req;
                        //NumLoad++;
                        //block_load = false;
                    }
                    

                }, type: 'POST',
                beforeSend: function () {
                   
                }
                
            });
        }


    }


    function ReloadSemantic() {
        goAjaxRequest({
            url: '/Physic/ReloadSemanticRecord',
            data: {},
            
            func_success: function (req, status, jqXHR) {
                
                alert('Запись очищена');
            }, type: 'POST',
            beforeSend: function () {

            }

        });
    }

    ;
</script>