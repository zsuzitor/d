


@model dip.Models.ViewModel.SearchV.DescriptionSearchV


@{
    ViewBag.Title = "DescriptionSearch";
}

<h2>DescriptionSearch</h2>


<div>
    <h4>ФОРМА поиска</h4>

    @Html.Hidden(" ", Url.Action("DescriptionSearch", "Search"), new { id = "descr_search_href_id" })
    
     

    @Html.Action("DescriptionFormAll", "Actions", new { objFormsBegin = Model.FormObjectBegin, objFormsEnd = Model.FormObjectEnd,
    inp = Model.FormInput,
    outp = Model.FormOutput
})





    <div>
        
        <div class="div_inline_block descrForm_div_search_but">
            <p class="text-center">
                <button class="width_100per btn btn-default" onclick="Go_next_step()">Поиск</button>
                </p>
</div>
        <div class="div_inline_block descrForm_div_clear_but">
            <button class="width_100per btn btn-default" onclick="clearForm()">Очистить форму</button>
        </div>
        <div class="div_inline_block descrForm_div_shwh_but">
            <div id="showHideDescrForm" class="width_100per btn btn-primary" onclick="showHideDescrForm()">Скрыть форму</div>
        </div>
       
    </div>
        @*<button onclick="Go_next_step()">Поиск</button>*@
        <div id="search_content_div_id">

            @if (Model?.SearchList != null)
            {
                @Html.Action("ListFeText", "Physic", new { listId = Model?.SearchList })
            }

        </div>

      
        <div>

            @Html.ActionLink("Назад на главную страницу", "Index", "Home")
        </div>
    </div>





@section Scripts {
    <script>



        function goSave() {//formData
            if (!data_descr_search.stateBegin) {
                alert('Выберите начальное состояние');
                return;
            }
            var twoObject = document.getElementById('changeObjectCheckbox').checked;

            if (twoObject && !data_descr_search.stateEnd) {
                alert('Выберите конечное состояние');
                return;
            }

            data_descr_search.function_trigger = null;

            

            goAjaxRequest({
                url: "/Search/DescriptionSearch",
                data: data_descr_search,
                func_complete: function (data, status, jqXHR) {//func_success

                    //alert(data);
                    if (status == 'error')
                        console.log('error partial search');
                    else {
                        document.getElementById('search_content_div_id').innerHTML = data.responseText;//responseText убрать если будет success
                        //data_descr_search.function_trigger = goSave;
                        
                       
                    }
                    data_descr_search = {
                        search: data_descr_search.search,
                        function_trigger: goSave
                    };
                    showHideDescrForm(false);
                },
                type:'POST'
            });



            //xhr.send(data_descr_search);//formData
        }







        //------------------------------------------------------
        //action:true- показать
        function showHideDescrForm(action) {
            var form = document.getElementById('DescriptionFormMainAll');
            var but = document.getElementById('showHideDescrForm');
            if (action == null || action == undefined) {
                if (form.style.display == 'block') {
                    hideForm();
                }

                else {
                    showForm();
                }
            }
            else {
                if (action) {
                    showForm();
                }
                else {
                    hideForm();
                }
            }
            
             

            function showForm() {
                form.style.display = 'block';
                but.innerHTML = 'Скрыть форму';
            }
            function hideForm() {
                form.style.display = 'none';
                but.innerHTML = 'Показать форму';
            }
        }


        //------------------------------------------------------

        function clearForm() {
            //$("#actionI option[value='VOZ1']").prop("selected", true);
            //$("#actionO option[value='VOZ1']").prop("selected", true);
            //$("#actionTypeI option[value='NO_ACTIONS']").prop("selected", true);
            //$("#actionTypeO option[value='NO_ACTIONS']").prop("selected", true);
            
            
            var i = 0;
            var inpdiv = document.getElementById('actionI'+i);
            while (inpdiv) {
                //var valFirstAction = $("#actionI" + i)[0].value;
                //var valFirstActionType = $("#actionTypeI" + i)[0].value;
                //$("#actionI" + i + " option[value='" + valFirstAction + "']").prop("selected", true);
                $("#actionI" + i).val($("#actionI" + i + " option:first").val());
                $("#actionTypeI" + i).val($("#actionTypeI" + i + " option:first").val());
               //$("#actionTypeI" + i + " option[value='" + valFirstActionType + "']").prop("selected", true);
                changeParams('I' + i);
                inpdiv = document.getElementById('actionI' + ++i);
            }
             i = 0;
             inpdiv = document.getElementById('actionO' + i);
             while (inpdiv) {
                 //var valFirstAction = $("#actionO" + i)[0].value;
                 //var valFirstActionType = $("#actionTypeO" + i)[0].value;
                 //$("#actionO" + i + " option[value='" + valFirstAction + "']").prop("selected", true);
                 //$("#actionTypeO" + i + " option[value='" + valFirstActionType + "']").prop("selected", true);
                 $("#actionO" + i).val($("#actionO" + i + " option:first").val());
                 $("#actionTypeO" + i).val($("#actionTypeO" + i + " option:first").val());
                changeParams('O' + i);
                inpdiv = document.getElementById('actionO' + ++i);
             }


             $('#changeTwoInputFormDescr_id').removeAttr("checked");
             var div2Input = document.getElementById('block_one_descr_input_1');
       
             div2Input.style.display = 'none';
          

            var url_ = document.getElementById("descr_search_href_id").value;
            history.pushState(null, null, url_);


            //object
            $('#changeObjectCheckbox').removeAttr("checked");
            document.getElementById('formPartEndId').style.display = 'none';

            for (let i = 0; i < 3; ++i) {
                document.getElementById('PhaseObject_data_S_' + i).innerHTML = '';
                document.getElementById('PhaseObject_all_S_' + i).style.display = 'none';
                document.getElementById('PhaseObject_data_E_' + i).innerHTML = '';
                document.getElementById('PhaseObject_all_E_' + i).style.display = 'none';
                
            }
            $('#mainBlockStates_S input:radio:checked').each(function () {//[type=checkbox] 
                $(this).removeAttr("checked");

                let dv = document.getElementById('stateChilds_' + this.id.split('change_state_radio_id_')[1]);
                if (dv)
                    dv.innerHTML = '';
            });
            $('#mainBlockStates_E input:radio:checked').each(function () {//[type=checkbox] 
                $(this).removeAttr("checked");

               let dv= document.getElementById('stateChilds_' + this.id.split('change_state_radio_id_')[1]);
               if (dv)
                   dv.innerHTML = '';
            });
            
            

        }



        $(document).ready(function () {
            // ggg(goSave);
            data_descr_search.function_trigger = goSave;

        });

    </script>
}
